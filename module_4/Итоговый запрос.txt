Итоговый запрос:

WITH main_table AS -- вылеты из Анапы (зимний период 2016-2017 гг)

  (SELECT f.flight_id,
          f.flight_no,
          f.arrival_airport,
          f.departure_airport,
          f.aircraft_code,
          f.actual_departure,
          f.actual_arrival,
          EXTRACT(HOUR
                  FROM (f.actual_arrival - f.actual_departure)) * 60 + EXTRACT(MINUTE
                                                                               FROM (f.actual_arrival - f.actual_departure)) AS flight_time
          
   FROM dst_project.flights AS f
   WHERE departure_airport = 'AAQ'
     AND (date_trunc('month', scheduled_departure) IN ('2017-01-01',
                                                       '2017-02-01',
                                                       '2016-12-01'))
     AND status NOT IN ('Cancelled')), count_seats AS -- таблица с количеством мест в по классам

  (SELECT s.aircraft_code,
          count(CASE
                    WHEN s.fare_conditions = 'Economy' THEN s.fare_conditions
                END) AS economy_seat,
          count(CASE
                    WHEN s.fare_conditions = 'Business' THEN s.fare_conditions
                END) AS business_seat,
          count(*) AS total_seat
   FROM dst_project.seats AS s
   GROUP BY 1), sold_tickets AS -- таблица проданных билетов выручка от продажи по классам

  (SELECT tf.flight_id,
          count(CASE
                    WHEN tf.fare_conditions = 'Economy' THEN tf.fare_conditions
                END) AS economy_sold,
          count(CASE
                    WHEN tf.fare_conditions = 'Business' THEN tf.fare_conditions
                END) AS business_sold,
          count(*) AS total_sold,
          sum(CASE
                  WHEN tf.fare_conditions = 'Economy' THEN tf.amount
              END) AS economy_amount,
          sum(CASE
                  WHEN tf.fare_conditions = 'Business' THEN tf.amount
              END) AS business_amount,
          sum(tf.amount) AS total_amount
   FROM dst_project.ticket_flights AS tf
   GROUP BY 1)
SELECT mt.flight_id, -- id рейса
 mt.flight_no, -- номер рейса
 apd.city AS departure_city, -- город отправления
 ap.city AS arrival_city, -- город прибытия
 mt.actual_departure, -- фактическое время вылета
 mt.actual_arrival, -- фактическое время прилёта
 mt.flight_time, -- время полета
 a.model, -- модель самолета
 ct.aircraft_code, -- код самолета
 ct.economy_seat, -- количество мест в эконом-классе
 ct.business_seat, -- количество мест в бизнес-классе
 ct.total_seat, -- общее количество мест
 st.economy_sold, -- количество проданных билетов в эконом-класс
 st.business_sold, -- количество проданных билетов в бизнес-класс
 st.total_sold, -- общее количество проданных билетов
 st.economy_amount, -- выручка от продажи билетов в эконом-класс
 st.business_amount, -- выручка от продажи билетов в бизнес-класс
 st.total_amount -- общая выручка от продаж билетов за полет
FROM main_table AS mt
LEFT JOIN dst_project.aircrafts AS a ON mt.aircraft_code = a.aircraft_code
LEFT JOIN dst_project.airports AS ap ON ap.airport_code = mt.arrival_airport
LEFT JOIN dst_project.airports apd ON mt.departure_airport = apd.airport_code
LEFT JOIN count_seats AS ct ON ct.aircraft_code = mt.aircraft_code
LEFT JOIN sold_tickets AS st ON st.flight_id = mt.flight_id
ORDER BY 5
